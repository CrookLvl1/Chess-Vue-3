var qe=Object.defineProperty;var He=(o,e,t)=>e in o?qe(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var k=(o,e,t)=>(He(o,typeof e!="symbol"?e+"":e,t),t);import{d as q,f as C,o as y,g as v,a as g,n as P,u as c,c as O,H as Y,l as pe,q as Fe,I as Ue,t as $,F as j,E as G,j as N,r as E,e as ae,w as oe,T as fe,y as Le,i as re,m as je,p as de,v as Ne,B as Ve,C as Qe,D as Je,k as Ye,J as Ge}from"./index-fdab419b.js";import{u as ye,a as We}from"./paths-1b58ad80.js";import{_ as Q,u as J}from"./_plugin-vue_export-helper-f2631dae.js";import{P as Ze,u as ce}from"./HomeView-70a528f5.js";var Be=(o=>(o["-1 0"]="top",o["0 -1"]="left",o["0 1"]="right",o["1 0"]="bottom",o["-1 1"]="top-right",o["-1 -1"]="top-left",o["1 1"]="bottom-right",o["1 -1"]="bottom-left",o))(Be||{});class ie{constructor(e,t,s){k(this,"figure");k(this,"row");k(this,"column");k(this,"hint");k(this,"selected");k(this,"checked");this.figure=e,this.row=t,this.column=s,this.hint=!1,this.selected=!1,this.checked=!1}getCoords(){return[this.row,this.column]}setCoords(e){this.row=e[0],this.column=e[1]}getFigure(){return this.figure}setFigure(e){this.figure=e}isFree(){return this.figure===null}getHint(){return this.hint}setHint(e){this.hint=e}isSelected(){return this.selected}switchSelected(){this.selected=!this.selected}getChecked(){return this.checked}setChecked(e){this.checked=e}}let ze=0;class L{constructor(e,t,s=null){k(this,"color");k(this,"type");k(this,"stolenType");k(this,"id");this.color=e,this.type=t,this.stolenType=s,this.id=ze++}getId(){return this.id}getSrc(){return`${this.type}${this.color}.png`}getColor(){return this.color}getType(){return this.type}getStolenType(){return this.stolenType}setStolenType(e){this.stolenType=e}}class _e extends L{constructor(...t){super(...t);k(this,"moved",!1)}isMoved(){return this.moved}switchMoved(){this.moved=!0}}class Xe{constructor(e,t,s){k(this,"cellsArr");k(this,"soloPlay");k(this,"colorDown");k(this,"turn");k(this,"lastTurn");k(this,"blackPositions");k(this,"whitePositions");k(this,"whiteKingCell");k(this,"blackKingCell");k(this,"whiteFiguresCells");k(this,"blackFiguresCells");k(this,"whiteThreefoldRepeat");k(this,"blackThreefoldRepeat");k(this,"userHandleTurn");k(this,"whiteKingDefence");k(this,"blackKingDefence");k(this,"kingSecureCells");k(this,"whiteCheck",!1);k(this,"blackCheck",!1);k(this,"directions");k(this,"turnInt");k(this,"initFigureType",(e,t)=>{if(e===2||e===6)return"pawn";if(e===0||e===7)switch(t){case 0:case 7:return"rook";case 1:case 6:return"knight";case 2:case 5:return"bishop";case 3:return"queen";case 4:return"king"}return"pawn"});this.soloPlay=e,this.colorDown=t,this.cellsArr=[],this.turn="white",this.lastTurn=null,this.turnInt=0,this.kingSecureCells=new Set,this.blackPositions={},this.whitePositions={},this.whiteThreefoldRepeat=!1,this.blackThreefoldRepeat=!1,this.userHandleTurn=!1,this.whiteKingCell=null,this.blackKingCell=null,this.whiteKingDefence=null,this.blackKingDefence=null,this.blackCheck=!1,this.whiteCheck=!1,this.whiteFiguresCells=[],this.blackFiguresCells=[],this.blackKingDefence=null,this.whiteKingDefence=null,this.directions={diagonal:{"top-left":[-1,-1],"top-right":[-1,1],"bottom-left":[1,-1],"bottom-right":[1,1]},lineal:{top:[-1,0],bottom:[1,0],left:[0,-1],right:[0,1]},knight:{"top-right-top":[-2,1],"top-right-bottom":[-1,2],"bottom-right-top":[1,2],"bottom-right-bottom":[2,1],"bottom-left-bottom":[2,-1],"bottom-left-top":[1,-2],"top-left-bottom":[-1,-2],"top-left-top":[-2,-1]}};for(let n=0;n<8;n++){this.cellsArr.push([]);for(let l=0;l<8;l++)if(n<2||n>5){const r=this.initFigureType(n,l),i=n<2?"black":"white";r==="king"?(this.cellsArr[n].push(new ie(new _e(i,r),n,l)),this[`${i}KingCell`]=this.cellsArr[n][l]):r==="rook"?(this.cellsArr[n].push(new ie(new _e(i,r),n,l)),this[`${i}FiguresCells`].push(this.cellsArr[n][l])):(this.cellsArr[n].push(new ie(new L(i,r),n,l)),this[`${i}FiguresCells`].push(this.cellsArr[n][l]))}else this.cellsArr[n].push(new ie(null,n,l))}console.log(this.cellsArr)}setUserHandleTurn(){this.userHandleTurn=!0}filterBy(e,t,s){return e.filter(n=>{const l=n.getFigure();return t.includes(l==null?void 0:l.getType())||t.includes(l==null?void 0:l.getStolenType())&&(l==null?void 0:l.getColor())!==s})}calcKingSecure(e){console.log("king SECURE = ",e);const t=[],n=this[`${e}KingCell`].getCoords(),l=e==="white"?"black":"white",r=[];for(const i in this.directions.lineal)r.push({arr:this.checkDirections({row:n[0],column:n[1],mainDirection:"lineal",allyColor:l,checkDirections:[i]}),mainDirection:"lineal",direction:i});for(const i in this.directions.diagonal)r.push({arr:this.checkDirections({row:n[0],column:n[1],mainDirection:"diagonal",allyColor:l,checkDirections:[i]}),mainDirection:"diagonal",direction:i});r.forEach(i=>{if(i.arr.length===0)return;const a=i.arr[i.arr.length-1],d=a.getCoords(),p=this.filterBy(this.checkDirections({row:d[0],column:d[1],allyColor:e,mainDirection:i.mainDirection,checkDirections:[i.direction]}),["queen",i.mainDirection==="diagonal"?"bishop":"rook"],e),f=p[p.length-1];f&&t.push({cell:a,direction:i.direction,mainDirection:i.mainDirection,attackingCellCoords:f.getCoords()})}),this[`${e}KingDefence`]=t}isCheckMate(e){const t=this.checkTurns(...this[`${e}KingCell`].getCoords());if(t.own.length>0||t.stolen.length>0)return"default";const s=this[`${e}FiguresCells`];for(const n of s){const l=this.checkTurns(...n.getCoords());for(const r of l.own)if(this.kingSecureCells.has(r))return"default";for(const r of l.stolen)if(this.kingSecureCells.has(r))return"default"}return"checkmate"}isDraw(e){if(this.blackThreefoldRepeat&&this.whiteThreefoldRepeat)return["draw","threefoldRepeat"];if(this.turnInt>75)return["draw","seventyFiveMovesRule"];const t=this.checkTurns(...this[`${e}KingCell`].getCoords());if(t.own.length>0||t.stolen.length>0)return["default",null];for(const s of this[`${e}FiguresCells`]){const n=this.checkTurns(...s.getCoords());if(n.own.length>0||n.stolen.length>0)return["default",null]}return["draw","stalemate"]}getMenaceCells(e,t,s,n,l=!1){const r=new Set,i=s==="white"?["top-left","top-right"]:["bottom-left","bottom-right"];if(l)return[...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal",ignoreTypes:["king"]}),["bishop","queen"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal",checkDirections:i,range:1}),["pawn"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"lineal",ignoreTypes:["king"]}),["queen","rook"],s),...this.filterBy(this.checkKnight(e,t,s),["knight"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"lineal",range:1}),["king"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal",range:1}),["king"],s)].forEach(a=>r.add(a)),r;switch(n){case"line":{[...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal"}),["bishop","queen"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal",checkDirections:i,range:1}),["pawn"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"lineal"}),["queen","rook"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"lineal",range:1}),["king"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal",range:1}),["king"],s)].forEach(a=>r.add(a));break}case"knight":{this.filterBy(this.checkKnight(e,t,s),["knight"],s).forEach(a=>r.add(a));break}case"all":{[...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal"}),["bishop","queen"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal",checkDirections:i,range:1}),["pawn"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"lineal"}),["queen","rook"],s),...this.filterBy(this.checkKnight(e,t,s),["knight"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"lineal",range:1}),["king"],s),...this.filterBy(this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal",range:1}),["king"],s)].forEach(a=>r.add(a));break}}return r}checkKingMenaces(e){var d,p,f,D;const t=this[`${e}KingCell`].getCoords(),s=t[0],n=t[1];let l=!1;const r=this.getMenaceCells(s,n,e,"line"),i=this.getMenaceCells(s,n,e,"knight"),a=e==="white"?"black":"white";if(this[`${a}Check`]=!1,(d=this[`${a}KingCell`])==null||d.setChecked(!1),i.size+r.size>1)return l=!0,this.kingSecureCells.clear(),this[`${e}Check`]=!0,(p=this[`${e}KingCell`])==null||p.setChecked(!0),!0;if(r.size>0||i.size>0){if(l=!0,this.kingSecureCells.clear(),this[`${e}Check`]=!0,(f=this[`${e}KingCell`])==null||f.setChecked(!0),r.size>0)for(const h of r){let[F,w]=h.getCoords(),T=[F-s,w-n],_,M,B;T[0]===0?(_="lineal",B=Math.abs(T[1])):T[1]===0?(_="lineal",B=Math.abs(T[0])):(_="diagonal",B=Math.abs(T[0])),M=Be[T.map(R=>R/B).join(" ")],this.checkDirections({row:s,column:n,allyColor:e,mainDirection:_,checkDirections:[M]}).forEach(R=>this.kingSecureCells.add(R))}if(i.size>0)for(const h of i)this.kingSecureCells.add(h)}else this.kingSecureCells.clear(),this[`${e}Check`]=!1,(D=this[`${e}KingCell`])==null||D.setChecked(!1);return l}getLastTurn(){return this.lastTurn}getCell(e,t){return this.cellsArr[e][t]}getCells(){return this.cellsArr}getFilteredCells(e){const t=[];if(e){for(let s=0;s<8;s++)for(let n=0;n<8;n++)this.cellsArr[s][n].isFree()||t.push(this.cellsArr[s][n]);return t}else for(let s=0;s<8;s++)for(let n=0;n<8;n++)this.cellsArr[s][n].isFree()&&t.push(this.cellsArr[s][n]);return t}getSoloplay(){return this.soloPlay}getColorDown(){return this.colorDown}getTurn(){return this.turn}switchTurn(){this.turn=this.turn==="white"?"black":"white"}isPawnLongMove(e,t,s,n){const l=s.getColor();return(s.getType()==="pawn"&&n==="own"||s.getStolenType()==="pawn"&&n==="stolen")&&(l==="white"&&e===6||l==="black"&&e===1)&&Math.abs(e-t)===2}getTurnType(e,t,s,n,l){var D,h;const r=this.cellsArr[e][t],i=this.cellsArr[s][n],a=(D=r.getFigure())==null?void 0:D.getType(),d=(h=r.getFigure())==null?void 0:h.getStolenType(),p=Math.abs(n-t);return a==="king"&&p===2&&l==="own"?"castling":this.lastTurn&&(this.lastTurn.figure.getStolenType()==="pawn"||this.lastTurn.figure.getType()==="pawn")&&p===1&&this.isPawnLongMove(this.lastTurn.fromRow,this.lastTurn.toRow,this.lastTurn.figure,this.lastTurn.figureTurnType)&&s===(this.lastTurn.fromRow+this.lastTurn.toRow)/2&&i.isFree()&&(a==="pawn"&&l==="own"||d==="pawn"&&l==="stolen")?"en passant":"default"}updateCell(e,t,s,n){const l=this[`${s}FiguresCells`],r=this.cellsArr[e][t];r.setFigure(null),l.splice(l.findIndex(i=>r===i),1),n&&l.push(n)}oppositeDirection(e){switch(e){case"bottom":return"top";case"top":return"bottom";case"left":return"right";case"right":return"left";case"bottom-left":return"top-right";case"bottom-right":return"top-left";case"top-left":return"bottom-right";case"top-right":return"bottom-left"}}isStealAvailable(e,t){if(console.log("is Steal AVailable = ",e,t),e===t)return!1;switch(e){case"queen":return t!=="bishop"&&t!=="rook";default:return!0}}updateStolenType(e){this.lastTurn.stolenType=e}checkThreefoldRepeat(e,t,s){if(!this[`${e}ThreefoldRepeat`]){const n=t.getId(),l=this[`${e}Positions`];l[n]||(l[n]=new Map);const r=l[n],i=(r.get(s)||0)+1;i>=3?this[`${e}ThreefoldRepeat`]=!0:r.set(s,i)}}moveFigure(e,t,s,n,l,r,i=!0){var _,M;const a=this.cellsArr[e][t],d=a.getFigure(),p=d.getColor(),f=this.cellsArr[s][n];this.checkThreefoldRepeat(p,d,f),console.log("move Figure = ",e,t,s,n,this.cellsArr[e][t],this.cellsArr[s][n]);const D=p==="white"?"black":"white",h=d.getType(),F=f.getFigure()||null,w=(F==null?void 0:F.getType())||null,T=f.isFree()?null:f.getCoords();switch(T&&(this.turnInt=0,this.updateCell(...T,D)),h==="pawn"&&(this.turnInt=0),f.setFigure(a.getFigure()),this.cellsArr[e][t].setFigure(null),l){case"castling":{const B=n>t?7:0;this.moveFigure(e,B,e,B===0?3:5,"default",r,!1);break}case"en passant":{this.updateCell(e,n,D);break}}return h==="king"?(this.cellsArr[e][t].setChecked(!1),this[`${p}Check`]=!1,this[`${p}KingCell`]=f,((_=this[`${p}KingCell`])==null?void 0:_.getFigure()).switchMoved()):this.updateCell(e,t,p,f),h==="rook"&&d.switchMoved(),i&&(this.lastTurn={fromRow:e,fromColumn:t,toRow:s,toColumn:n,figureTurnType:r,fromFigureType:h,toFigureType:w,type:l,figure:new L(p,h,d.getStolenType()),stolenType:null},this.turnInt++),r==="stolen"&&((M=f.getFigure())==null||M.setStolenType(null)),!!(h==="pawn"&&s===(p==="white"?0:7)&&(this.soloPlay||this.turn===this.colorDown))}transformFigure(e,t,s,n,l=null){const r=!!l&&this.isStealAvailable(n,l);this.cellsArr[e][t].setFigure(new L(s,n,r?l:null))}isBusyByColor(e,t,s){var n;return!this.cellsArr[e][t].isFree()&&((n=this.cellsArr[e][t].getFigure())==null?void 0:n.getColor())===s}isInField(e,t){return e>=0&&e<=7&&t>=0&&t<=7}checkDirections({row:e,column:t,allyColor:s,mainDirection:n,checkDirections:l,range:r=100,ignoreTypes:i}){const a=[],d=this.directions[n];for(let p in d){if(l&&!l.includes(p))continue;let f=r;const D=d[p];let h=e+D[0],F=t+D[1];for(;this.isInField(h,F)&&f>0;){const w=this.cellsArr[h][F];if(!w.isFree()&&!(i!=null&&i.includes(w.getFigure().getType()))){if(this.isBusyByColor(h,F,s))break;a.push(this.cellsArr[h][F]);break}a.push(this.cellsArr[h][F]),f--,h+=D[0],F+=D[1]}}return a}checkPawn(e,t,s){const n=[];let l,r,i;s==="white"?(l=-1,r=e===6?2:1,i=["top-right","top-left"]):(l=1,r=e===1?2:1,i=["bottom-left","bottom-right"]);let a=e+l;for(;r>0&&this.isInField(a,t)&&this.cellsArr[a][t].isFree();)n.push(this.cellsArr[a][t]),a+=l,r--;return n.push(...this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal",checkDirections:i,range:1}).filter(d=>!d.isFree())),n}checkKnight(e,t,s){const n=[],l=this.directions.knight;for(let r in l){const i=l[r],a=e+i[0],d=t+i[1];!this.isInField(a,d)||this.isBusyByColor(a,d,s)||n.push(this.cellsArr[a][d])}return n}checkKingTurns(e){const t=[],s=this[`${e}KingCell`],[n,l]=s.getCoords();if(t.push(...this.checkDirections({row:n,column:l,allyColor:e,mainDirection:"diagonal",range:1}),...this.checkDirections({row:n,column:l,allyColor:e,mainDirection:"lineal",range:1})),!s.getChecked()&&!s.getFigure().isMoved()){const r=this.filterBy(this.checkDirections({row:n,column:l,allyColor:e==="white"?"black":"white",mainDirection:"lineal",checkDirections:["left","right"]}),["rook"],e);r.length>0&&r.forEach(i=>{if(i.getFigure().isMoved())return;const a=i.getCoords(),d=this.checkDirections({row:a[0],column:a[1],allyColor:e,mainDirection:"lineal",checkDirections:[a[1]===0?"right":"left"]});for(const p of d){const f=p.getCoords();if(this.getMenaceCells(f[0],f[1],e,"all").size>0)return}t.push(this.cellsArr[n][l+(i.getCoords()[1]===0?-2:2)])})}return t.filter(r=>{const[i,a]=r.getCoords();return this.getMenaceCells(i,a,e,"all",!0).size===0})}checkTurnsType(e,t,s,n){let l=[];const r=this.cellsArr[e][t];switch(n){case"pawn":{l.push(...this.checkPawn(e,t,s)),this.lastTurn&&this.lastTurn.type==="default"&&(this.lastTurn.figure.getType()==="pawn"&&this.lastTurn.figureTurnType==="own"||this.lastTurn.figure.getStolenType()==="pawn"&&this.lastTurn.figureTurnType==="stolen")&&Math.abs(this.lastTurn.toRow-this.lastTurn.fromRow)===2&&e===this.lastTurn.toRow&&(this.lastTurn.fromColumn+1===t||this.lastTurn.fromColumn-1===t)&&l.push(this.cellsArr[(this.lastTurn.fromRow+this.lastTurn.toRow)/2][this.lastTurn.fromColumn]);break}case"rook":{l.push(...this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"lineal"}));break}case"knight":{l.push(...this.checkKnight(e,t,s));break}case"bishop":{l.push(...this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal"}));break}case"queen":{l.push(...this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"diagonal"}),...this.checkDirections({row:e,column:t,allyColor:s,mainDirection:"lineal"}));break}case"king":{l.push(...this.checkKingTurns(s));break}}const i=this[`${s}KingDefence`];if(i&&i.length>0){const a=i==null?void 0:i.find(d=>d.cell===r);if(a){const d=[...this.checkDirections({row:e,column:t,allyColor:s,mainDirection:a.mainDirection,checkDirections:[a.direction]}),...this.checkDirections({row:e,column:t,allyColor:s,mainDirection:a.mainDirection,checkDirections:[this.oppositeDirection(a.direction)]})];l=l.filter(p=>d.includes(p))}}return l}eatFigure(e,t){var s;this.updateCell(e,t,(s=this.cellsArr[e][t].getFigure())==null?void 0:s.getColor()),this.cellsArr[e][t].setFigure(null)}checkTurns(e,t){const s=this.cellsArr[e][t].getFigure(),n=s.getColor(),l=s.getType(),r=s.getStolenType(),i={own:this.checkTurnsType(e,t,n,l),stolen:r?this.checkTurnsType(e,t,n,r):[]};if(l==="king"){if(i.stolen=i.stolen.filter(a=>this.getMenaceCells(...a.getCoords(),s.getColor(),"all",!0).size===0),r==="pawn"){const a=n==="white"?-1:1;if(a===-1&&e===6||a===1&&e===1){const d=[this.cellsArr[e+a*2][t-1],this.cellsArr[e+a*2][t+1]].filter(p=>{const f=p.getFigure();return(f==null?void 0:f.getType())==="pawn"&&f.getStolenType()==="pawn"});i.stolen=i.stolen.filter(p=>d.includes(p))}}}else this[`${n}Check`]&&(i.own=i.own.filter(a=>this.kingSecureCells.has(a)),i.stolen=i.stolen.filter(a=>this.kingSecureCells.has(a)));return console.log("TURNS = ",i),i}getHints(e,t){return this.checkTurns(e,t)}}const et={class:"figure-wrapper"},tt={class:"main-img-wrapper"},st=["src"],nt=["src"],lt=q({__name:"figureComponent",props:{figure:{type:[Object,null],required:!0}},setup(o){const e=o,t=ye().paths,s=C(()=>{var n;return t.get((n=e.figure)==null?void 0:n.getSrc())});return(n,l)=>{var r;return y(),v("div",et,[g("div",tt,[o.figure?(y(),v("img",{key:0,loading:"lazy",src:s.value,alt:""},null,8,st)):P("",!0)]),(r=o.figure)!=null&&r.getStolenType()?(y(),v("img",{key:0,loading:"lazy",class:"stolen",src:c(t).get(o.figure.getStolenType()+o.figure.getColor()+".png"),alt:""},null,8,nt)):P("",!0)])}}});const te=Q(lt,[["__scopeId","data-v-f24e49ed"]]),it={class:"hint"},rt=q({__name:"cellComponent",props:{cell:{type:Object,required:!0},turn:{type:String,required:!0},soloPlay:{type:Boolean,required:!0},colorDown:{type:String,required:!0},lastTurn:{type:[Object,null],required:!0},rotate:{type:Boolean,required:!0}},setup(o){const e=o;let t=C(()=>{const s=e.cell;let n=s.getCoords().reduce((i,a)=>i+a)%2?"#7c573e":"#908782";const l=e.lastTurn,r=s.getCoords();return(l==null?void 0:l.fromRow)===r[0]&&(l==null?void 0:l.fromColumn)===r[1]||(l==null?void 0:l.toRow)===r[0]&&(l==null?void 0:l.toColumn)===r[1]?n="#90955a":s.getChecked()?n="#d17363":s.isSelected()&&(n="#b18f4f"),n});return(s,n)=>{var l;return y(),v("li",{class:"cell-wrapper",style:Y({backgroundColor:c(t),boxShadow:o.cell.isSelected()?`0 0 50px 0 ${c(t)}`:"",cursor:o.turn===((l=o.cell.getFigure())==null?void 0:l.getColor())&&(o.soloPlay||o.turn===o.colorDown)||o.cell.getHint()?"pointer":"default"})},[o.cell.getFigure()?(y(),O(te,{key:0,style:Y({transform:o.rotate?"rotate(180deg)":""}),figure:o.cell.getFigure()},null,8,["style","figure"])):P("",!0),pe(g("div",it,[g("div",{class:Ue(["circle",{"cell-attacked":!o.cell.isFree()}])},null,2)],512),[[Fe,o.cell.getHint()]])],4)}}});const at={class:"choose-menu-wrapper"},ot={class:"figures"},ct=["data-type","onClick"],ut=q({__name:"pawnTransform",props:{color:{type:String,required:!0},row:{type:Number,required:!0},column:{type:Number,required:!0}},emits:{changeFigure:o=>!0},setup(o,{emit:e}){const t=o,s=["queen","bishop","knight","rook"],n=l=>new L(t.color,l);return(l,r)=>(y(),v("ul",at,[g("li",null,[g("h3",null,$(c(J)().getStrings.choose)+":",1)]),g("ul",ot,[(y(),v(j,null,G(s,i=>g("li",{key:i,"data-type":i,class:"choosable-figure",onClick:a=>e("changeFigure",i)},[N(te,{figure:n(i)},null,8,["figure"])],8,ct)),64))])]))}});const ht=Q(ut,[["__scopeId","data-v-a6135639"]]),gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAADI0lEQVR4nO2Yb0gTYRzHR/Uigl70roLeBL3xjeELMQxfzAi0F1JvfGGgRiISRNRAvSgJ9jrSFJMF1otNGrSdugnbbXOijjmGZNsQZ3IO57Xndvc87nCXf6a/uAPfRYtKp/B84MsdD8/z3PPle/f8OYOBcoxobW0tHxwc/GAymToMJ5Hu7u6va2tr0N/fD9XV1VWGk0ZDQ0O4s7MTmpub9ysrK8sPygHgdDKZLON5vh4h1EEIMSmK8jCfz99VFKUMAE4ZjgNNTU23GxsbSU1NjdPhcDR7PJ7RUCiUisVihVQqBZIkQT6fh93dXTigUCjA9vb2vqqqP1RV/a4oSoQQ8hFj/BhjfHN9ff3ckRlgGKbCbDZDW1ub7HQ6geM4CIfDkEgk4HcGdnZ2YGtrC1RVhc3NTcjlckAIAYwxZLPZPYRQCiHkQwgNZjKZZ4Ig1IuieC0ajRY1x/P8WVmWb0iS9EQUxVFZll8VNdDe3r7zvwxobURRBIQQZDIZ/aopm83qEkVxUxTFtCRJcUJIDGMcJYR8wRh/wxgjWZb3ZFmGAyGEosfKgCRJurT6GxsbeltN2v1BH9RAgiYg0ldIph9xis5CQKdRmS5kEl2JEd1KILqZA7obRXQ7/WvogUY9ZieyiYkJ8Pl8EAgEdAWDQZicnISZmRmYm5uDWCwGKysroP1LEgRBH5g2GO2hJTXQ0tJC+vr6cr29vZ8HBgaeWyyWe8PDw9dHRkauWK3WCy6XS5fX673s8/kqpqam7vj9/gd+v/8Fx3HvPR5PKBAI5LTz9Pz8PMTjcVheXtaN/q0BSZL0doIgsEUN1NXVferp6Tlj+EdcLtdFt9ttHB8f72BZ9q3D4eDGxsbWvV4vTE9PQyQSgYWFBVhcXITV1VVIp9N6kpo0s1qZlvDS0pJWJ51MJi08z1cVNVBbW/vOcIiwLHvebreX2Ww2o81mu2+1Wp/a7fbXLMsOud3uIY7j3gSDwZezs7OPIpHIrWg0eumPOj4qA4cGQw2UGIYmUGIYmkCJYWgCJYahCZQYhiZQYpiTnkBXV9dVs9nsNBqN7aUeC8VwQvgJ0tCtovl/NF8AAAAASUVORK5CYII=",dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDElEQVR4nO2aS09TQRiGH2OhTbxguYhL2Wk0yq9QqhhBV162RlaI/QHi0qArIn9EbQiJ0SAaUS5KYhSorFQWRl0WqsSaSd6TTIBiT8+lZxLepOlpZ+bMvGe+mfm+9zuwCzfwBnjts81B4DJwD3gCLAHfgXWgDPwCPgEF4D5wEcgSMSr6/A9NwBXgKfDbalfrZwOYAK4D6UYQaQbywKpV9w/wHBjWzBwDOjTAJj3940AfcEd1163233TPTFxEzgNFq84CcKNOMzmktrPW/T4DOSIkYp7UQ+Cvyj6E2SHQA7yz+h4LY3Y2EzkMzOg/Yw63gRThYy9wCyipL9NnZ1hEjgLL+m1MqpvocUq7ntdnV1Ai7dYNZzUzcSELvFTfK8CRIESm9f0WOED82GeNYaaeNWPv9StB7TQg2iyrMBuAL/g51KaIZ82U1J/Z3SIh8oJ4MGQt/lAPzbiRAt6LjCHlNM6JyKrrs7IHmBOZqziOmyIyjuPIKr4x3nYLjmNSs3IBx3FXREZwHP0i8gjHcUJEFnEc7SJixI0tmIrJbwoDaSvI24KyCo2w4DSRnypsJfno2Mm0vHDWSDZOL/aCCo0CmHRc2mn7faBCI545fSD2qfAZ7rgovdWcsQ3tBEYBTCpaLafRCOfbYkJMjYyZVAxojGZNV8U1S8NKamA1rzGaLMCOB81XVTxL8tCrsX2pJQ2RV+V5abFJEh8WNLbBWhpkJO1XJCgnBXmNaclPUiinRiWJY41GN7CmMZ3x23jMegJGtmykX1XUWEbruUHGyolMS1COG/uVmK3oOx3kaSxairz5HefB98pKxwUW0rusqTVmdpp41kRRfS4r2RQKOi0zK0l7jSL1ltLutGaZU+jJpYy1AVQkKOdCPLFNttg7J7yFHUnu3UPPpvT0nGTMbJ3rYMByOyoyJd9bbJDZGbLcmYo80km9MNCvKK5NGkCzrk8qKBpWXU8n8NyOwahnoRrSUsXHFQL4SRB5b0sU5AA2hMB2aJEWa6K2x3qB5oeeelnXHxWejqhu1XhiFziOf7QdImdWDCRDAAAAAElFTkSuQmCC",pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwElEQVR4nO2YPyhFURzHP3gDSTFY3kAMSgaDDEqiDBaLKEoy+TPJLHqLkoU3WoVBsVgwyiRkkVIGBiVGeim5unXU9brevXK6vfN+v0/9ltu959zvp3vPPfcHiqIoiqIoyg88B8sqnoOlAmziOVgqwCaeg6UCbOI5WCrAJp6DpQICNP5XkudgBemQLmBAuoBx6QLmpQtYli5gQ7qAfekCTqQLuJEu4FmygArgQ7KA+phPSckKaJUuoEe6gCHpAqalC1iQLmBNuoAt6QIOpQu4sCEgir6YN5UDxkiW+yQEjMQI/wh0kjxvSQiYjQh/BTSEXFcF1AFpoBloA7qBfmDQiJ0ApoA5IAOsAFnT5dkEdoED4BQ4B66BOyM8F/M1+TdLBSbZA6rzzs8UwRphVUD2lwn84+VFGt6qgO28gd+ByZDziim8VQFHgUFfgF4HwlsVcGkGvAVaHAlvVcADcAzUOhTeqoBVIOVYeKsCksJvbrzGDBe2DpUE7RHb2+8apoRJA2cRAmYocSqBnQICFhFAmVloP0MErCOI0ZAfH78TJIou4CkgwO8EiaPJ/A57phMkkhrTH/A/lWJJmd2poij8iS9GyatYWJ2gbQAAAABJRU5ErkJggg==",ft={class:"message-wrapper"},yt=["src"],mt={class:"text-wrapper"},kt={key:0,class:"read"},vt={class:"basic-info"},Ct=["data-hint-msg"],At={key:0},bt={class:"text"},Tt=q({__name:"messageComponent",props:{player:{type:Ze,required:!0},message:{type:Object,required:!0}},setup(o){const e=o,t=C(()=>J().getStrings);let s=E(!1);const n=C(()=>{const i=e.player.getName();return i.length>10?(s.value=!0,i.slice(0,8)+"..."):i}),l=ae(e.message.text.split(`
`)),r=(()=>{const i=e.message.date.getMinutes(),a=e.message.date.getHours();return`${a>=10?a:"0"+a}:${i>=10?i:"0"+i}`})();return(i,a)=>(y(),O(fe,{name:"message-appearance",appear:""},{default:oe(()=>[g("div",ft,[g("img",{style:Y({borderColor:o.player.getImgBorder()}),src:o.player.getImgSrc()||c(ye)().guestImgHref},null,12,yt),g("div",mt,[!o.message.currentUserSender&&!o.message.read?(y(),v("div",kt)):P("",!0),g("div",vt,[g("h5",{class:"player-name","data-hint-msg":c(s)?o.player.getName():null},$(n.value),9,Ct),o.message.currentUserSender?(y(),v("h5",At,$(o.message.read?t.value.read:t.value.unread),1)):P("",!0),g("h5",null,$(c(r)),1)]),g("ul",bt,[(y(!0),v(j,null,G(l,(d,p)=>(y(),v("li",{key:p,class:"text-line"},$(d),1))),128))])])])]),_:1}))}});const Se=Q(Tt,[["__scopeId","data-v-73a0b633"]]),wt={class:"messenger-wrapper"},_t={class:"messenger-header"},St={class:"chat"},Dt={class:"messages-list-wrapper"},Ft=["data-id"],Bt={key:1},$t={class:"user-input"},Mt=["placeholder","onKeypress"],Rt=q({__name:"messengerWindowComponent",emits:["close"],setup(o,{emit:e}){const t=ce(),s=C(()=>J().getStrings),n=C(()=>t.getPlayer),l=C(()=>t.getEnemyPlayer),r=E(),i=E("");let a=C(()=>t.getMessages),d=ae([]);const p=async()=>{t.sendMessage(i.value),i.value=""},f=()=>{i.value.length<=0||p().then(()=>{var w;(w=r.value)==null||w.scrollBy({top:r.value.scrollHeight})})},D=w=>{if(w.shiftKey){i.value+=`
`;return}f()},h=(()=>{let w;return function(){clearTimeout(w),w=setTimeout(()=>{t.sendReadMessages(d),d=[]},2e3)}})(),F=ae([]);return Le(()=>{let w=new IntersectionObserver((T,_)=>{T.forEach(M=>{M.isIntersecting&&setTimeout(()=>{_.unobserve(M.target);const B=a.value.find(R=>R.id===+M.target.dataset.id);B&&(B.read=!0,d.push(B.id),h())},1e3)})},{root:r.value,rootMargin:"0px",threshold:.8});re(F,(T,_)=>{T.length!==0&&w.observe(T[T.length-1])})}),(w,T)=>(y(),O(fe,{name:"messenger"},{default:oe(()=>[g("div",wt,[g("div",_t,[g("h4",St,$(s.value.chatting),1),g("button",{onClick:T[0]||(T[0]=_=>e("close")),class:"icon icon-cancel icon-exit-behavior"})]),g("div",Dt,[g("ul",{ref_key:"messagesWrapper",ref:r,class:"messages-list"},[(y(!0),v(j,null,G(c(a),_=>(y(),v(j,{key:_.id},[_.currentUserSender?(y(),v("li",Bt,[N(Se,{player:_.currentUserSender?n.value:l.value,message:_},null,8,["player","message"])])):(y(),v("li",{key:0,ref_for:!0,ref:"opponentMessages","data-id":_.id},[N(Se,{player:_.currentUserSender?n.value:l.value,message:_},null,8,["player","message"])],8,Ft))],64))),128))],512)]),g("div",$t,[pe(g("textarea",{maxlength:"150`",placeholder:s.value.typeAMessage+`...
`+s.value.nextLine,onKeypress:je(de(D,["prevent"]),["enter"]),"onUpdate:modelValue":T[1]||(T[1]=_=>i.value=_)},null,40,Mt),[[Ne,i.value]]),g("button",{class:"classic-button send-btn",onClick:f},[g("span",null,$(s.value.send),1)])])])]),_:1}))}});const Et=Q(Rt,[["__scopeId","data-v-c4c7ebea"]]),me=o=>(Qe("data-v-98780308"),o=o(),Je(),o),It={class:"player-wrapper"},Kt={class:"avatar"},Pt=["src"],xt=["data-hint-msg"],Ot={key:0},qt={class:"player-buttons"},Ht=me(()=>g("img",{class:"surrender",src:gt,alt:""},null,-1)),Ut=me(()=>g("img",{class:"rotate",src:dt,alt:""},null,-1)),Lt={class:"unread-messages"},jt=me(()=>g("img",{class:"chat",src:pt,alt:""},null,-1)),Nt={class:"timer"},Vt=q({__name:"playerComponent",props:{playerObj:{type:Object,required:!0},you:{type:Boolean,required:!0},solo:{type:Boolean,required:!0}},emits:["gameOver","rotate"],setup(o,{emit:e}){const t=o,s=C(()=>J().getStrings),n=ce(),l=C(()=>n.getMessages.filter(w=>!w.currentUserSender&&!w.read));let r=C(()=>t.playerObj.getImgSrc()||ye().guestImgHref),i=E(!1),a=C(()=>t.playerObj.getName()||s.value.guest),d=C(()=>a.value.length>8?(i.value=!0,a.value.slice(0,6)+"..."):a.value),p=C(()=>{const w=t.playerObj.getTime();return w<=0?(t.playerObj.stop(),e("gameOver",s.value.timeLose,f),0):Math.round(w)}),f=t.playerObj.getColor(),D=E(!1);const h=()=>D.value=!D.value,F=C(()=>t.solo);return(w,T)=>(y(),v("div",It,[g("div",Kt,[g("img",{src:c(r),alt:"",style:Y(`border-color: ${o.playerObj.getImgBorder()}`)},null,12,Pt),g("span",{"data-hint-msg":c(i)?c(a):null,class:"player-name"},$(c(d)),9,xt),Ve(),o.you?(y(),v("span",Ot,$(`(${s.value.you})`),1)):P("",!0)]),g("div",qt,[o.you?(y(),v("button",{key:0,class:"classic-button classic-button-small",onClick:T[0]||(T[0]=_=>e("gameOver",s.value[`${o.playerObj.getColor()}Surrendered`],c(f),!0))},[g("span",null,$(s.value.surrender),1),Ht])):(y(),v(j,{key:1},[pe(N(Et,{onClose:h},null,512),[[Fe,c(D)]]),g("button",{class:"classic-button classic-button-small",onClick:T[1]||(T[1]=_=>e("rotate"))},[g("span",null,$(s.value.rotate),1),Ut]),F.value?P("",!0):(y(),v("button",{key:0,onClick:h,class:"classic-button classic-button-small chat-button"},[g("span",null,$(c(D)?s.value.closeChat:s.value.openChat),1),g("div",Lt,$(l.value.length>0?l.value.length:""),1),jt]))],64))]),g("div",Nt,[g("span",null,$(c(p)<600?`0${Math.floor(c(p)/60)}`:Math.floor(c(p)/60))+": "+$(c(p)%60<10?`0${c(p)%60}`:c(p)%60),1)])]))}});const De=Q(Vt,[["__scopeId","data-v-98780308"]]),Qt={class:"info"},Jt={key:0},Yt={key:1},Gt={key:2},Wt={class:"buttons"},Zt=q({__name:"gameEndComponent",props:{result:{type:String,required:!0},winner:{type:String,required:!0},reason:{type:String,required:!1}},emits:["gameOver"],setup(o,{emit:e}){const t=J().getStrings,s=ce(),n=C(()=>s.getPlayer),l=C(()=>s.getEnemyPlayer);let r=E(!1);return n.value.getStarted()&&n.value.stop(),l.value.getStarted()&&l.value.stop(),e("gameOver"),(i,a)=>(y(),O(fe,{appear:"",name:"from-above"},{default:oe(()=>[g("div",{class:"game-end-wrapper",style:Y({transform:c(r)?"translateY(-97.5%)":""})},[g("div",Qt,[o.result==="checkmate"?(y(),v("span",Jt,$(c(t)[`${o.winner}Win`]),1)):(y(),v("span",Yt,$(c(t).draw),1)),o.reason?(y(),v("span",Gt,$(o.reason),1)):P("",!0)]),g("div",Wt,[g("button",{class:"classic-button",onClick:a[0]||(a[0]=d=>c(s).resetInfo())},$(c(t).returnButton),1)]),g("button",{class:"classic-button fold-button",onClick:a[1]||(a[1]=d=>Ye(r)?r.value=!c(r):r=!c(r)),style:Y(`${c(r)?"bottom":"top"}: 1rem`)},$(c(r)?c(t).unfold:c(t).fold),5)],4)]),_:1}))}});const zt=Q(Zt,[["__scopeId","data-v-3224cf36"]]),Xt={class:"steal-menu-wrapper"},es={key:0,class:"figures-steal-list"},ts=["onClick"],ss=["onClick"],ns=q({__name:"stealTurnsComponent",props:{color:{type:String,required:!0},possibleSteal:{type:Array,required:!0}},emits:{stealTurns:o=>!0},setup(o,{emit:e}){const t=o,s=J().getStrings;console.log("STEAL LOADED");const n=l=>new L(t.color,l);return(l,r)=>(y(),v("div",Xt,[g("h5",null,$(c(s).steal)+"?",1),o.possibleSteal?(y(),v("ul",es,[(y(!0),v(j,null,G(o.possibleSteal,i=>(y(),v("li",{key:i,class:"choosable-figure",onClick:a=>e("stealTurns",i)},[N(te,{figure:n(i)},null,8,["figure"])],8,ts))),128))])):P("",!0),(y(!0),v(j,null,G(o.possibleSteal,i=>(y(),v("button",{class:"choose-figure",key:i,onClick:a=>e("stealTurns",i)},null,8,ss))),128)),g("button",{onClick:r[0]||(r[0]=i=>e("stealTurns",null)),class:"classic-button classic-button-small refuse-steal-btn"},$(c(s).stealRefuse),1)]))}});const ls=Q(ns,[["__scopeId","data-v-7801349c"]]),is={class:"user-clarify-wrapper"},rs={class:"type-select"},as=q({__name:"userTurnClarifyComponent",props:{figure:{type:L,required:!0}},emits:{clarify:o=>!0},setup(o,{emit:e}){const t=o,s=C(()=>t.figure.getColor()),n=C(()=>t.figure.getType()),l=C(()=>t.figure.getStolenType()),r=i=>new L(s.value,i);return(i,a)=>(y(),v("div",is,[g("ul",rs,[g("h5",null,$(c(J)().getStrings.chooseTurn)+":",1),g("li",{class:"choosable-figure",onClick:a[0]||(a[0]=d=>e("clarify","own"))},[N(te,{figure:r(n.value)},null,8,["figure"])]),g("li",{class:"choosable-figure",onClick:a[1]||(a[1]=d=>e("clarify","stolen"))},[N(te,{figure:r(l.value)},null,8,["figure"])])])]))}});const os=Q(as,[["__scopeId","data-v-b75adbb3"]]),cs={class:"player-wrapper-relative"},us=["onClick"],ys=q({__name:"chessPlayComponent",props:{soloPlay:{type:Boolean,required:!0},player:{type:Object,required:!0},enemyPlayer:{type:Object,required:!0}},setup(o){const e=o,t=J(),s=C(()=>t.getStrings),n=ce();let l=C(()=>t.getVolume);const r=We().paths,a=(u=>{const m=(b,S)=>(b=Math.ceil(b),S=Math.floor(S),Math.floor(Math.random()*(S-b+1)+b)),A=[];for(const b of u){const S=new Audio;S.src=b,A.push(S)}return function(){const b=A[m(0,u.length-1)];b.volume=l.value,b.play(),b.currentTime=0}})(r),d=C(()=>n.getPlayer),p=C(()=>n.getEnemyPlayer);let f=C(()=>d.value.getColor()),D=C(()=>f.value==="white"?"black":"white");const h=ae(new Xe(e.soloPlay,f.value));let F=E("default"),w=E("white"),T=E(),_=!1,M,B,R=E(0),I=E(0),V,W=E(!1),K=C(()=>h.getTurn()),se=C(()=>h.getSoloplay()),Z=C(()=>h.getLastTurn()),ne=E([]),X=E([]),z=E(null),ue=E(null),he=C(()=>F.value==="default"&&ne.value.length===0&&!(X.value.length>0)&&!z.value);const $e=()=>h.checkKingMenaces(K.value)&&h.isCheckMate(K.value)==="checkmate"?["checkmate","checkmate"]:h.isDraw(K.value),le=()=>{h.switchTurn(),h.calcKingSecure(K.value),ue.value=null,K.value===f.value?(d.value.start(),p.value.stop()):(p.value.start(),d.value.stop());const u=$e();switch(u[0]){case"checkmate":{ee("checkmate",s.value[u[1]],K.value==="black"?"white":"black");break}case"draw":{ee("draw",s.value[u[1]]);break}}},ge=()=>{W.value=!W.value},ee=(u,m,A)=>{T.value=m,F.value=u,A&&(w.value=A)},Me=u=>{X.value=[],u&&(h.updateStolenType(u),h.getCell(R.value,I.value).getFigure().setStolenType(u)),he.value&&(le(),n.sendTurnInfo({fromRow:M,fromColumn:B,toRow:R.value,toColumn:I.value,figureTurnType:Z.value.figureTurnType,stolenType:u,figureType:null,turnType:Z.value.type}))},ke=(u,m,A)=>{const b=h.getTurnType(M,B,R.value,I.value,A),S=u.getFigure();X.value=Ie(b,m,S,A),h.moveFigure(M,B,R.value,I.value,b,A)&&(ne.value=[R.value,I.value]),a(),Ae(u),he.value&&(le(),n.sendTurnInfo({fromRow:M,fromColumn:B,toRow:R.value,toColumn:I.value,figureType:null,figureTurnType:A,stolenType:null,turnType:b}))},Re=u=>{ke(z.value,ue.value.getFigure(),u)},Ee=u=>{var m;h.transformFigure(R.value,I.value,K.value,u,(m=h.getCell(R.value,I.value).getFigure())==null?void 0:m.getStolenType()),ne.value=[],le(),n.sendTurnInfo({fromRow:M,fromColumn:B,toRow:R.value,toColumn:I.value,figureType:u,figureTurnType:Z.value.figureTurnType,stolenType:Z.value.stolenType,turnType:Z.value.type})},ve=(u,m)=>{u.own.forEach(A=>A.setHint(m)),u.stolen.forEach(A=>A.setHint(m))},Ce=(u,m,A)=>{const b=[],S=u.getType(),x=m.getType(),H=m.getStolenType();let U=u.getStolenType();return U&&A==="stolen"&&(U=null),U!==x&&h.isStealAvailable(S,x)&&b.push(x),H&&H!==U&&h.isStealAvailable(S,H)&&b.push(H),b},Ie=(u,m,A,b)=>{let S=[];return u==="en passant"?S=Ce(A,h.getCell(M,I.value).getFigure(),b):m&&(S=Ce(A,m,b)),S},Ae=u=>{_=!1,u.switchSelected(),z.value=null,ve(V,!1),V={own:[],stolen:[]}},Ke=u=>{var b;if(!he.value)return;(W.value&&f.value==="white"||!W.value&&f.value==="black")&&ge();let m=u.target;for(;m&&!m.classList.contains("cell-wrapper")&&m.tagName!=="LI"&&m.tagName!=="UL";)m=m.parentElement;if(!m||!m.classList.contains("cell-wrapper")||m.tagName==="UL")return;const A=h.getCell(+m.dataset.row,+m.dataset.column);if(!A.isFree()&&K.value===((b=A.getFigure())==null?void 0:b.getColor())&&(se.value||K.value===f.value)||A.getHint())if(_){R.value=+m.dataset.row,I.value=+m.dataset.column;const S=h.getCell(M,B),x=h.getCell(R.value,I.value);if(!x.getHint()){Ae(S);return}const H=S.getFigure(),U=x.getFigure();if((H==null?void 0:H.getColor())===(U==null?void 0:U.getColor()))return;ue.value=x;const Te=V.own.includes(x),Oe=h.getTurnType(M,B,R.value,I.value,"own"),we=H.getStolenType()?h.getTurnType(M,B,R.value,I.value,"stolen"):null;Te&&V.stolen.includes(x)&&we&&Oe!==we?z.value=S:ke(S,U,Te?"own":"stolen")}else{M=+m.dataset.row,B=+m.dataset.column;const S=h.getCell(M,B);if(S.isFree()||(V=h.getHints(M,B),V.own.length===0&&V.stolen.length===0))return;ve(V,!0),S.switchSelected(),_=!0}},be=(u,m,A=!1)=>{A&&n.sendSurrender(),ee("checkmate",u,m==="white"?"black":"white")};f.value==="black"&&ge();let Pe=C(()=>n.surrenderLose),xe=C(()=>n.leaveLose);return re(n.turn,u=>{a(),h.moveFigure(u.fromRow,u.fromColumn,u.toRow,u.toColumn,u.turnType,u.figureTurnType),u.stolenType&&(h.updateStolenType(u.stolenType),h.getCell(u.toRow,u.toColumn).getFigure().setStolenType(u.stolenType)),u.figureType&&h.getCell(u.toRow,u.toColumn).setFigure(new L(K.value,u.figureType)),le()}),re(Pe,u=>{u&&ee("checkmate",s.value[`${D.value}Surrendered`],f.value)}),re(xe,u=>{u&&ee("checkmate",s.value.enemyLeft,f.value)}),(u,m)=>(y(),v("div",{class:"chess-container",onDragstart:m[0]||(m[0]=de(()=>{},["prevent"]))},[c(F)!=="default"?(y(),O(zt,{key:0,winner:c(w),reason:c(T),onGameOver:c(n).disconnectServer,player:d.value,color:c(n).leaveLose?c(D):c(K),result:c(F)},null,8,["winner","reason","onGameOver","player","color","result"])):P("",!0),g("div",cs,[(y(),O(De,{key:3,"game-end":c(F)!=="default",solo:c(se),you:!1,onRotate:ge,onGameOver:be,"player-obj":p.value},null,8,["game-end","solo","player-obj"])),N(Ge,{name:"from-above",appear:""},{default:oe(()=>{var A,b;return[c(ne).length>0?(y(),O(ht,{key:1,onChangeFigure:Ee,color:c(K),row:c(R),column:c(I)},null,8,["color","row","column"])):P("",!0),c(X).length>0?(y(),O(ls,{key:2,color:c(K),"possible-steal":c(X),onStealTurns:Me},null,8,["color","possible-steal"])):P("",!0),(A=c(z))!=null&&A.getFigure()?(y(),O(os,{key:4,onClarify:Re,figure:(b=c(z))==null?void 0:b.getFigure()},null,8,["figure"])):P("",!0)]}),_:1})]),g("ul",{id:"chessField",class:"chess-outer-list",onClick:de(Ke,["left"]),style:Y({transform:c(W)?"rotate(180deg)":""})},[(y(!0),v(j,null,G(h.getCells(),(A,b)=>(y(),v("ul",{key:A,class:"row"},[(y(!0),v(j,null,G(A,(S,x)=>(y(),O(rt,{key:S,rotate:c(W),"last-turn":c(Z),"color-down":c(f),"solo-play":c(se),turn:c(K),cell:S,"data-row":b,"data-column":x},null,8,["rotate","last-turn","color-down","solo-play","turn","cell","data-row","data-column"]))),128))]))),128))],12,us),N(De,{"game-end":c(F)!=="default",onGameOver:be,solo:c(se),you:!0,user:c(t).getUser,"player-obj":d.value},null,8,["game-end","solo","user","player-obj"])],32))}});export{ys as default};
